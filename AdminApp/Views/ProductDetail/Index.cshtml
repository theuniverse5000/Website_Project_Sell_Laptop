@{
    ViewBag.Title = "Product Details";
}

<div id="example">
   <button id="createproductdetail">Thêm</button>
    <div id="grid1"></div>
      <div class="demo-section wide">
@*         <textarea id="editor" rows="10" cols="30" style="width:100%; height:840px" aria-label="editor">
 *@        
    @* </textarea> *@
    </div>
</div>

<script>

    var loginButton = document.getElementById('createproductdetail');
    loginButton.addEventListener('click', function (event) {
        event.preventDefault();
        $.ajax({
            url: "/ProductDetail/Create",
            type: "GET",
            success: function (result) {
                $("#rootAdmin").html(result); // Cập nhật nội dung của phần tử trên trang web
            },
            error: function () {
                alert("Có lỗi xảy ra.");
            }
        });

    })


</script>

@section scripts {
    <link href="https://kendo.cdn.telerik.com/2021.3.914/styles/kendo.common.min.css" rel="stylesheet" />
    <link href="https://kendo.cdn.telerik.com/2021.3.914/styles/kendo.default.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2021.3.914/js/kendo.all.min.js"></script>
    <script>
        var editor = $("#editor").kendoEditor({
            stylesheets: [
                "../content/shared/styles/editor.css",
            ],
            tools: [
                "bold",
                "italic",
                "underline",
                "undo",
                "redo",
                "justifyLeft",
                "justifyCenter",
                "justifyRight",
                "insertUnorderedList",
                "createLink",
                "unlink",
                "insertImage",
                "tableWizard",
                "tableProperties",
                "tableCellProperties",
                "createTable",
                "addRowAbove",
                "addRowBelow",
                "addColumnLeft",
                "addColumnRight",
                "deleteRow",
                "deleteColumn",
                "mergeCellsHorizontally",
                "mergeCellsVertically",
                "splitCellHorizontally",
                "splitCellVertically",
                "tableAlignLeft",
                "tableAlignCenter",
                "tableAlignRight",
                "fontSize",
                "foreColor",
                "backColor",
            ]
        });
        // $(document).ready(function () {
        //     var dataSource = new kendo.data.DataSource({
        //         transport: {
        //             read: {
        //                 url: "/ProductDetail/GetProductDetail",
        //                 dataType: "json"
        //             },
        //             update: {
        //                 url: "/ProductDetail/Update", // Chỉnh sửa đường dẫn URL nếu cần
        //                 dataType: "json"
        //             },
        //             destroy: {
        //                 url: "/ProductDetail/Destroy", // Chỉnh sửa đường dẫn URL nếu cần
        //                 dataType: "json"
        //             },
        //             create: {
        //                 url: "/ProductDetail/CreateProductDetail", // Chỉnh sửa đường dẫn URL nếu cần
        //                 dataType: "json"
        //             },
        //             parameterMap: function (options, operation) {
        //                 if (operation !== "read" && options.models) {
        //                     return { models: kendo.stringify(options.models) };
        //                 }
        //             }
        //         },
        //         batch: true,
        //         pageSize: 20,
        //         schema: {
        //             data: "result",
        //             model: {
        //                 id: "id",
        //                 fields: {
        //                     code: {
        //                         type: "string", validate: { required: true }
        //                     },
        //                     status: { type: "int", validate: { required: true } }
        //                 }
        //             }
        //         }
        //     });

        //     $("#grid").kendoGrid({
        //         dataSource: dataSource,
        //         pageable: false,
        //         height: 550,
        //         toolbar: ["create"],
        //         columns: [
        //             { field: "code", title: "Product Name" },
        //             { field: "status", title: "Unit Price", format: "{0:c}", width: "120px" },
                   
        //             { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" }
        //         ],
        //         editable: "popup"
        //     });
        // });
        $(document).ready(function () {


          


            $("#grid1").kendoGrid({
                dataSource: {
                    transport: {
                        read: {
                            url: "/ProductDetail/GetProductDetail",
                            type: "GET",
                            dataType: "json"
                        },
                        create: {
                            url: "/ProductDetail/CreateProductDetail",
                            type: "POST",
                            dataType: "json",

                        },
                        update: {
                            url: "/",
                            type: "PUT",
                            dataType: "json"
                        },
                        destroy: {
                            url: "/",
                            type: "DELETE",
                            dataType: "json"
                        },

                    },
                    schema: {
                        data: "result",
                       total: "count", // Chỉ định tên trường tổng số dòng,
                        model: {
                            id: "id",
                            fields: {
                                code: { type: "string", validation: { required: true } },
                               price: { type: "int", validate: { required: true } },
                               status: { type: "int", validate: { required: true } }
                            }
                        }
                    },

                    pageSize: 20,

                    // thêm thành công sẽ hiển thị thông báo thêm thành công
                    requestEnd: function (e) {
                        if (e.type === "create" && e.response) {
                            var result = e.response.Result || {};
                            if (result.Errors && result.Errors.length > 0) {
                                alert("Thêm mới thất bại: " + result.Errors.join(", "));
                            } else {
                                alert("Thêm mới thành công!");
                            }
                        }
                    },
                },



                height: 550,
                groupable: false,
                sortable: true,
                pageable: {
                    refresh: true,
                    pageSizes: [5, 10, 20, "All"],
                    buttonCount: 3,
                    messages: {
                        itemsPerPage: "Số dòng trên mỗi trang",
                        display: "{0}-{1} trong {2} dòng"
                    }
                },

                toolbar: [
                    {
                        name: "create",
                        text: "Thêm", /* Thay đổi văn bản của nút "Thêm" */



                    },

                    "pdf"],
                pdf: {
                    allPages: true,
                    avoidLinks: true,
                    paperSize: "A4",
                    margin: { top: "2cm", left: "1cm", right: "1cm", bottom: "1cm" },
                    landscape: true,
                    repeatHeaders: true,
                    template: $("#page-template").html(),
                    scale: 0.8,
                },
                editable: {
                    mode: "popup",
                    window: { width: 1500, height: 1000 }, // Chỉnh chiều rộng ở đây
                },
                columns: [
                    {
                        field: "code",
                        title: "Mã"
                    },
                    {
                        field: "nameProduct",
                        title: "Tên sản phẩm"
                    },
                    {
                        field: "nameManufacturer",
                        title: "Hãng sản xuất",

                        editor: function (container, options) {
                            // Create the DropDownList
                            $('<input id="name" data-bind="value:' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    autoBind: false,
                                    optionLabel: "Select product...",
                                    dataTextField: "nameManufacturer",
                                    dataValueField: "id",
                                    dataSource: {
                                        type: "odata",
                                        serverFiltering: true,
                                        transport: {
                                            read: "https://localhost:44333/api/ProductDetail/GetProductDetailsFSP"
                                        }
                                    },
                                    change: function () {
                                        var grid = $("#grid").data("kendoGrid");
                                        var selectedItem = this.dataItem();
                                        grid.editCell(grid.tbody.find("td").eq(options.index), grid.columns[options.field]);
                                        grid.dataSource.data()[options.model.uid][options.field] = selectedItem.nameProductType;
                                    }
                                });
                        }
                    },
                    {
                        field: "nameProductType",
                        title: "Dòng sản phẩm",
                       // hidden: true, // Ẩn cột này

                                

                    },
                    {
                        field: "tenCpu", // Đặt tên cho cột tùy chỉnh
                        title: "Vi xử lý",
                         hidden: true // Ẩn cột này
                        
                    },
                    {
                        field: "thongSoRam",
                        title: "Ram",
                        // Ẩn cột này
                    },
                    {
                        field: "thongSoHardDrive",
                        title: "SSD",
                        hidden: true // Ẩn cột này
                    },
                    {
                        field: "price",
                        title: "Giá"
                    },
                    {
                        field: "availableQuantity",
                        title: "Số lượng"
                    }, {
                        field: "availableQuantity",
                        title: "Số lượng"
                    },

                    {
                        field: "yourFieldName", // Replace with your actual field name
                        title: "Your Field Title",
                        editor: function (container, options) {
                            // Create a textarea element
                            var textarea = $('<textarea name="description" id="editor"  style="width:1000; heigpxht:840px" aria-label="editor"></textarea>')
                                .attr("name", options.field)
                                .appendTo(container);

                            // Bind the field's value to the textarea
                            textarea.val(options.model[options.field]);

                            // Enable the textarea
                            textarea.prop("disabled", false);

                            // Handle changes in the textarea
                            textarea.on("change", function () {
                                options.model[options.field] = textarea.val();
                            });
                        }
                    },



                    {
                        command: [
                            {
                                name: "edit",
                                text: "Sửa",
                            },
                            {
                                name: "destroy",
                                text: "Xóa",

                            },
                        ],
                        title: "Hành động",
                        width: "250px"
                    }
                ],

            });
            var newTextarea = $('<textarea id="editor" rows="10" cols="30" style="width:100%; height:840px" aria-label="editor"></textarea>');

            // Find elements with the specified class and prepend the textarea before them
            $(".k-edit-buttons.k-state-default").prepend(newTextarea);
        });


    </script>
}
